<ion-header translucent>
  <ion-toolbar>
    <ion-title>Today's Lesson</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen class="home-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <ion-spinner name="circles"></ion-spinner>
    <p>Loading your lesson...</p>
  </div>

  <!-- Error State -->
  <ion-card *ngIf="error && !loading" class="error-card">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="alert-circle"></ion-icon>
        Error
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ error }}</p>
      <ion-button expand="block" shape="round" (click)="reloadData()">
        Try Again
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Main Content -->
  <div *ngIf="!loading && !error && currentUser && dailyLesson" class="lesson-content">
    <!-- Daily Lesson Card - Fullscreen -->
    <ion-card class="lesson-card">
      <!-- Lesson Header with Integrated Badges -->
      <ion-card-header class="lesson-card-header">
        <!-- Badges - Floating on top -->
        <div class="lesson-badges-top">
          <ion-chip
            [style.--background]="getDifficultyColor(dailyLesson.difficulty)"
            class="difficulty-badge"
          >
            {{ getDifficultyLabel(dailyLesson.difficulty) }}
          </ion-chip>
          <div class="xp-reward">
            <ion-icon name="star"></ion-icon>
            <span>{{ dailyLesson.xpReward }} XP</span>
          </div>
        </div>

        <!-- Title and Subtitle -->
        <div class="lesson-header-content">
          <ion-card-title class="lesson-title">{{ dailyLesson.title }}</ion-card-title>
          <ion-card-subtitle>{{ dailyLesson.description }}</ion-card-subtitle>
        </div>
      </ion-card-header>

      <!-- Lesson Body Content -->
      <ion-card-content class="lesson-body">
        <!-- Lesson Content with Markdown Rendering -->
        <div class="lesson-text" [innerHTML]="(dailyLesson.content || '') | markdown"></div>

        <!-- Key Points -->
        <div *ngIf="dailyLesson.keyPoints && dailyLesson.keyPoints.length > 0" class="key-points">
          <h4>Key Points:</h4>
          <ul>
            <li *ngFor="let point of dailyLesson.keyPoints">{{ point }}</li>
          </ul>
        </div>

        <!-- Examples -->
        <div *ngIf="dailyLesson.examples && dailyLesson.examples.length > 0" class="examples">
          <h4>Examples:</h4>
          <ul>
            <li *ngFor="let example of dailyLesson.examples">
              <code>{{ example }}</code>
            </li>
          </ul>
        </div>

        <!-- Estimated Time -->
        <div class="lesson-meta-info">
          <ion-icon name="time"></ion-icon>
          <span>{{ dailyLesson.estimatedMinutes }} min read</span>
        </div>
      </ion-card-content>

      <!-- Completion Section -->
      <div class="completion-section">
        <!-- Completion Message -->
        <div *ngIf="lessonCompleted" class="completion-success">
          <ion-icon name="checkmark-circle"></ion-icon>
          <p>{{ completionMessage }}</p>
        </div>

        <!-- Complete Button -->
        <ion-button
          *ngIf="!lessonCompleted"
          expand="block"
          shape="round"
          size="large"
          color="primary"
          (click)="completeLesson()"
          [disabled]="!canCompleteLesson"
          class="complete-button"
        >
          <ion-icon name="checkmark-done" slot="start"></ion-icon>
          Complete Lesson
        </ion-button>

        <!-- Loading State for Completion -->
        <div *ngIf="isCompletingLesson" class="completion-loading">
          <ion-spinner name="crescent" color="primary"></ion-spinner>
          <p>Saving your progress...</p>
        </div>
      </div>
    </ion-card>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && !dailyLesson" class="empty-state">
    <ion-icon name="checkmark-circle"></ion-icon>
    <h2>No Lesson Available</h2>
    <p>Check back tomorrow for your next lesson!</p>
  </div>
</ion-content>
